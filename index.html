<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Parcel Box</title>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body{
  background:#111;
  color:white;
  font-family:sans-serif;
  text-align:center;
  margin-top:80px;
}

h1{
  font-size:28px;
}

input{
  font-size:20px;
  padding:10px;
  width:180px;
  text-align:center;
  border-radius:8px;
  border:none;
}

button{
  font-size:22px;
  padding:12px 25px;
  border:none;
  border-radius:8px;
  background:#00c853;
  color:white;
  cursor:pointer;
  margin-top:15px;
}

button:hover{
  background:#00e676;
}

#status{
  margin-top:30px;
  font-size:18px;
}

.success{
  color:#00e676;
}

.error{
  color:#ff5252;
}

.wait{
  color:#ffd740;
}
</style>
</head>
<body>

<h1>üì¶ Smart Parcel Box</h1>

<input type="password" id="pass" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ 4 ‡∏´‡∏•‡∏±‡∏Å">
<br>
<button onclick="openBox()">üîì ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á</button>

<div id="status" class="wait">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT...</div>

<script>

const statusText = document.getElementById("status");

// ===== MQTT Connect =====
const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

client.on("connect", function () {
  statusText.innerHTML = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT ‡πÅ‡∏•‡πâ‡∏ß";
  statusText.className = "success";

  client.subscribe("parcel/status");
});

client.on("error", function () {
  statusText.innerHTML = "‚ùå MQTT Error";
  statusText.className = "error";
});

// ===== ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å ESP =====
client.on("message", function(topic, message) {

  const msg = message.toString();

  if(msg === "correct"){
    statusText.innerHTML = "üîì ‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á...";
    statusText.className = "success";
  }
  else if(msg === "wrong"){
    statusText.innerHTML = "‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    statusText.className = "error";
  }
  else if(msg === "locked"){
    statusText.innerHTML = "‚õî ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß";
    statusText.className = "error";
  }
});

// ===== ‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ ESP =====
function openBox(){

  const password = document.getElementById("pass").value;

  if(password.length === 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™");
    return;
  }

  client.publish("parcel/pass", password);

  statusText.innerHTML = "üì° ‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß...";
  statusText.className = "wait";
}

</script>

</body>
</html>
